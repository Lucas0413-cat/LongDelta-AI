# 用户操作手册

## 目录

1. [快速开始](#快速开始)
2. [功能介绍](#功能介绍)
3. [使用示例](#使用示例)
4. [常见问题](#常见问题)
5. [故障排除](#故障排除)

## 快速开始

### 环境准备

1. 安装 Python 3.11+
2. 安装 uv 包管理器：
```bash
pip install uv
```

3. 克隆项目并安装依赖：
```bash
cd LongDelta-AI
uv sync
```

4. 配置 API 密钥：
```bash
# 编辑 .env 文件
LLM_MODEL=deepseek-chat
LLM_BASE_URL=https://api.deepseek.com/v1
LLM_API_KEY=your_api_key_here
```

### 启动服务

**方式一：分别启动前后端**

终端 1 - 后端：
```bash
uv run uvicorn src.api.server:app --reload
```

终端 2 - 前端：
```bash
uv run streamlit run frontend/app.py
```

**方式二：Docker 部署**

```bash
docker-compose up --build
```

### 访问应用

打开浏览器访问：http://localhost:8501

---

## 功能介绍

### 1. 智能对话分析

在输入框中输入自然语言问题，系统自动：
- 解析问题意图
- 查询相关数据
- 生成分析报告

### 2. 区域分析

支持分析长三角地区：
- 上海市
- 江苏省（南京、苏州、无锡等）
- 浙江省（杭州、宁波、温州等）
- 安徽省（合肥、芜湖、马鞍山等）

### 3. 多地区对比

支持对比分析：
- 江浙沪三省对比
- 任意两个地区对比
- 多个城市横向对比

### 4. 数据指标

支持的经济指标：
- GDP（国内生产总值）
- CPI（居民消费价格指数）
- 三产结构（产业结构）
- 更多指标持续更新中

### 5. 图表可视化

自动生成图表：
- 柱状图：地区对比、排名
- 折线图：趋势变化
- 饼图：结构占比

### 6. 短板识别

系统自动识别：
- 增长动能不足
- 产业结构问题
- 创新驱动薄弱
- 区域协调差距

并给出改进建议。

---

## 使用示例

### 示例 1：基础分析

**输入：**
```
分析2023年安徽GDP
```

**输出：**
- GDP 数值：47050 亿元
- 增长率：4.47%
- 增长趋势：稳中向好
- 综合分析结论
- 短板识别与改进建议

### 示例 2：对比分析

**输入：**
```
对比江浙沪三产结构
```

**输出：**
- 三省三产占比排名
- 上海（74.1%）> 浙江（54.2%）> 江苏（52.3%）
- 产业结构分析
- 各地区优劣势对比

### 示例 3：趋势分析

**输入：**
```
江苏2023年CPI对比2022年
```

**输出：**
- 2023年 CPI 数据
- 2022年 CPI 数据
- 变化率
- 物价走势分析

### 示例 4：时间序列

**输入：**
```
上海近5年GDP变化趋势
```

**输出：**
- 年度 GDP 数据表
- 折线图可视化
- 增长趋势分析

---

## 常见问题

### Q1: 识别不到地区怎么办？

确保问题中包含明确的地区名称：
- ✅ "安徽2023年GDP"
- ✅ "江苏2023年CPI"
- ✅ "对比江浙沪"
- ❌ "2023年GDP增长"

### Q2: 数据查询失败？

1. 检查后端服务是否运行：`curl http://localhost:8000/health`
2. 确认 LLM API 密钥配置正确
3. 查看后端日志

### Q3: 如何查看详细日志？

后端日志会打印到控制台，包括：
- 请求信息
- 工具调用
- 响应时间

### Q4: 支持其他省份吗？

目前支持长三角地区四省市：
- 上海
- 江苏
- 浙江
- 安徽

### Q5: 如何添加新的经济指标？

修改 `src/tools/implementation.py` 中的数据查询逻辑，并更新 `src/tools/parse.py` 中的指标识别规则。

---

## 故障排除

### 问题 1：前端无法连接后端

**症状：** 点击"检查后端连接"显示无法连接

**解决：**
```bash
# 1. 确认后端正在运行
curl http://localhost:8000/health

# 2. 检查端口是否正确
# 默认后端端口: 8000
# 默认前端 API_BASE: http://localhost:8000

# 3. 重启服务
# 关闭后端后重新运行
uv run uvicorn src.api.server:app --reload
```

### 问题 2：LLM 调用失败

**症状：** 分析超时或返回错误

**解决：**
1. 检查 API 密钥是否有效
2. 检查网络连接
3. 确认 API 限流

### 问题 3：数据为空

**症状：** 查询结果为空

**解决：**
1. 检查数据文件是否存在：`ls data/processed/`
2. 确认数据格式正确
3. 检查年份是否在数据范围内

### 问题 4：图表不显示

**症状：** 报告已生成但图表为空

**解决：**
1. 检查 Plotly 库是否安装
2. 查看浏览器控制台错误
3. 刷新页面重试

---

## 联系与支持

如有问题，请：
1. 查看后端日志获取详细错误信息
2. 检查 API 健康状态
3. 提交 Issue 到项目仓库

---

## 附录

### 支持的地区

| 地区 | 简称 | 省份/市 |
|------|------|---------|
| 安徽 | 安徽 | 省 |
| 江苏 | 江苏 | 省 |
| 浙江 | 浙江 | 省 |
| 上海 | 上海 | 市 |
| 南京 | 南京 | 市 |
| 苏州 | 苏州 | 市 |
| 杭州 | 杭州 | 市 |
| ... | ... | ... |

### 支持的指标

| 指标 | 说明 |
|------|------|
| GDP | 国内生产总值 |
| CPI | 居民消费价格指数 |
| 三产结构 | 三次产业占比 |

### 数据范围

- 年份：2019-2023
- 地区：长三角 41 个城市
- 指标：持续更新中
